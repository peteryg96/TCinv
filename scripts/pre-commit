#!/bin/bash

echo "üîç Running pre-commit checks..."

# Check for merge conflict markers
if git diff --cached | grep -E "^[<=>]{7}"; then
    echo "‚ùå Merge conflict markers found. Please resolve conflicts before committing."
    exit 1
fi

# Run linters
echo "üìù Running linters..."
cd backend && npm run lint
if [ $? -ne 0 ]; then
    echo "‚ùå Backend linting failed"
    exit 1
fi

cd ../frontend && npm run lint
if [ $? -ne 0 ]; then
    echo "‚ùå Frontend linting failed"
    exit 1
fi

# Check for console.log statements (optional)
echo "üîç Checking for console.log statements..."
if git diff --cached --name-only | grep -E '\.(js|jsx|ts|tsx)$' | xargs grep -n "console\.log" 2>/dev/null; then
    echo "‚ö†Ô∏è  Warning: console.log statements found. Consider removing them."
    # Uncomment to make this a hard failure:
    # exit 1
fi

# Check for .env files
if git diff --cached --name-only | grep -E "\.env$"; then
    echo "‚ùå .env files should not be committed"
    exit 1
fi

echo "‚úÖ Pre-commit checks passed!"
exit 0
